<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <!-- <title>D3 Test</title> -->
        <link href="styles.css" rel="stylesheet">
        <script src="https://d3js.org/d3.v5.min.js"></script>
    </head>
    <body>
        <script type="text/javascript">
            // Your beautiful D3 code will go here
            d3.select("head")
              .append("title")
              .attr("class", "title")
              .text("Labour participation Netherlands");

            d3.select("body")
              .append("p")
              .style("font-size", "25px")
              .style("font-weight", "bold")
              .text("Labour participation NL per province");

            d3.select("body")
              .append("p")
              .style("font-size", "15px")
              .style("font-weight", "normal")
              .text("Name: Julien Fer");

            d3.select("body")
              .append("p")
              .style("font-size", "15px")
              .style("font-weight", "normal")
              .text("Studentnumber: 10649441");

            d3.select("body")
              .append("p")
              .style("font-size", "15px")
              .style("font-weight", "normal")
              .text("The bar chart visualizes the unemployment rate in the netherlands per province (2018)")

            var file = "arbeidsdeelname.json";
            const width = 1000;
            const height = 500;
            const space = 100;
            const widthGraph = width - 2 * space;
            const heightGraph = height - space;
            var animateDuration = 700;
            var animateDelay = 100;
            var year = "2018";
            var barPadding = 1;
            var provinces = [];
            var data = [];
            var counter = 0;

            // read local JSON file
            d3.json(file).then(function(dataset) {
              provinces = Object.keys(dataset);

              provinces.forEach( function(province) {
                data.push(dataset[province][year]);
              })

              console.log(data);
              console.log(provinces);

              var svg = d3.select("body")
                          .append("svg")
                          .attr("class", "svg")
                          .attr("width", width)
                          .attr("height", height);

              var yScale = d3.scaleLinear()
                             .domain([0, d3.max(data)])
                             .range([heightGraph, space]);
              var xScale = d3.scaleLinear()
                             .domain([0, data.length])
                             .range([space, width - space]);

              // source code for tooltip:
              // https://www.youtube.com/watch?v=5pNz_Dyf9_c&index=7&list=PLillGF-RfqbY8Vy_G5WxXwhZx4eXI6Oea
              var tooltip = d3.select("body").append("div")
                            .attr("class", "tooltip")
                            .style('position','absolute')
                            .style('background','#f4f4f4')
                            .style('padding','5 15px')
                            .style('border','1px #333 solid')
                            .style('border-radius','5px')
                            .style('opacity','0')

              console.log(data);
              var myChart = svg.selectAll("rect")
                 .data(data)
                 .enter()
                 .append("rect")
                 .attr("class", "bar")
                 .attr("id", function(d, i) {
                   return provinces[i];
                 })
                 .attr("x", function(d, j) {
                      return xScale(j);
                  })
                  .attr("y", heightGraph)
                   .attr("fill", function(d) {
                       return "rgb(102, " + (d * 40) + ", 102)";
                   })
                 .attr("width", widthGraph / data.length - barPadding)
                 .attr("height", 0)
                  .on('mouseover', function(d, k){
					               tooltip.transition()
						                   .style('opacity', 1)

					               tooltip.html("Unemployment: " + d + "%")
						                   .style('left', (xScale(k) + 0.5 * widthGraph / data.length - barPadding)+ 'px')
						                   .style('top', (yScale(d) + 2 * space)+ 'px')

            					d3.select(this).style('opacity', 0.5)
            				})
            			   .on('mouseout', function(d){
            			   	tooltip.transition()
            			   		.style('opacity', 0)
            			   	d3.select(this).style('opacity', 1)
                    });


                svg.selectAll("text")
                   .data(data)
                   .enter()
                   .append("text")
                   .attr("class", "labels")
                   .text(function(d) {
                     return d;
                   })
                   .attr("x", function(d, i) {
                     return xScale(i) + 0.5 * widthGraph / data.length - barPadding;
                   })
                   .attr("y", function(d) {
                     return yScale(d) + 14;
                   });

                var xAxisScale = d3.scaleBand()
                                   .domain(provinces)
                                   .range([space, width - space])
                                   .paddingInner(0.05);

                var xAxis = d3.axisBottom()
                              .tickValues(provinces)
                              .ticks(provinces.length)
                              .scale(xAxisScale);

                var yAxis = d3.axisLeft()
                              .scale(yScale);

                yAxis.tickFormat(d => d + "%");




                svg.append("g")
                   .attr("class", "axis")
                   .attr("id", "xAxis")
                   .attr("transform", "translate(0," + (heightGraph - barPadding) + ")")
                   .call(xAxis)
                   .style("text-anchor", "end")
                   .selectAll("text")
                   .attr("transform", "rotate(-65)");

                svg.append("g")
                   .attr("class", "axis")
                   .attr("transform", "translate(" + space + ",0)")
                   .call(yAxis);

                // create Title
                svg.append("text")
                   .attr("x", width / 2 )
                   .attr("y", space / 2)
                   .attr("id", "titleGraph")
                   .style("text-anchor", "middle")
                   .style("font-weight", "bold")
                   .style("text-decoration", "underline")
                   .style("font-size", "20px")
                   .text("Unemployment rate the Netherlands per province (2018)");

                // create title y axis
                svg.append("text")
                   .attr("x", heightGraph / 2 - 2 * space - 240)
                   .attr("y", widthGraph / 2 - 3.5 * space)
                   .attr("transform", "rotate(-90)")
                   .attr("id", "titleXaxis")
                   .style("text-anchor", "middle")
                   .style("font-weight", "bold")
                   .style("font-size", "20px")
                   .text("Unemployment");

                // creat title x axis
                svg.append("text")
                   .attr("x", width / 2)
                   .attr("y", heightGraph + space)
                   .attr("id", "titleYaxis")
                   .style("text-anchor", "middle")
                   .style("font-weight", "bold")
                   .style("font-size", "20px")
                   .text("Provinces");

                myChart.transition()
                      .attr("height", function(d){
                        return heightGraph - yScale(d);
                      })
                      .attr("y", function(d, i){
                        return yScale(d);
                      })
                      .duration(animateDuration)
                      .delay(function(d, j){
                        return j * animateDelay;
                      })
                      .ease(d3.easeElastic);
              });




        </script>
    </body>
</html>
