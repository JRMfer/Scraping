<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <!-- <title>D3 Test</title> -->
        <link href="styles.css" rel="stylesheet">
        <script src="https://d3js.org/d3.v5.min.js"></script>
    </head>
    <body>
        <script type="text/javascript">
            // Your beautiful D3 code will go here
            d3.select("head")
              .append("title")
              .text("Labour participation Netherlands");

            d3.select("body")
              .append("p")
              .style("font-size", "25px")
              .style("font-weight", "bold")
              .text("Labour participation NL per province");

            d3.select("body")
              .append("p")
              .style("font-size", "15px")
              .style("font-weight", "normal")
              .text("Name: Julien Fer");

            d3.select("body")
              .append("p")
              .style("font-size", "15px")
              .style("font-weight", "normal")
              .text("Studentnumber: 10649441");

            d3.select("body")
              .append("p")
              .style("font-size", "15px")
              .style("font-weight", "normal")
              .text("The bar chart visualizes the unemployment rate in the netherlands per province (2018)")

            var file = "arbeidsdeelname.json";
            const width = 1000;
            const height = 500;
            const space = 100;
            const widthGraph = width - 2 * space;
            const heightGraph = height - space;
            var year = "2018";
            var barPadding = 1;
            var provinces = [];
            var data = [];
            var counter = 0;

            // read local JSON file
            d3.json(file).then(function(dataset) {
              provinces = Object.keys(dataset);

              provinces.forEach( function(province) {
                data.push(dataset[province][year]);
              })

              console.log(data);
              console.log(provinces);

              var svg = d3.select("body")
                          .append("svg")
                          .attr("width", width)
                          .attr("height", height);

              var yScale = d3.scaleLinear()
                             .domain([0, d3.max(data)])
                             .range([heightGraph, space]);
              var xScale = d3.scaleLinear()
                             .domain([0, data.length])
                             .range([space, width - space]);

              console.log(data);
              svg.selectAll("rect")
                 .data(data)
                 .enter()
                 .append("rect")
                 .attr("class", "bar")
                 .attr("id", function(d, i) {
                   return provinces[i];
                 })
                 .attr("x", function(d, j) {
                      return xScale(j);
                  })
                  .attr("y", function(d) {
                       return  yScale(d);// return height - d * 75;  //height minus data value
                   })
                   .attr("fill", function(d) {
                       return "rgb(102, " + (d * 40) + ", 102)";
                   })
                 .attr("width", widthGraph / data.length - barPadding)
                 .attr("height", function(d) {
                      return heightGraph - yScale(d);  // <-- Times four!
                  });


                svg.selectAll("text")
                   .data(data)
                   .enter()
                   .append("text")
                   .attr("class", "labels")
                   .text(function(d) {
                     return d;
                   })
                   .attr("x", function(d, i) {
                     return xScale(i) + 0.5 * widthGraph / data.length - barPadding;
                   })
                   .attr("y", function(d) {
                     return yScale(d) + 14;
                   });

                var xAxisScale = d3.scaleBand()
                                   .domain(provinces)
                                   .range([space, width - space])
                                   .paddingInner(0.05);

                var xAxis = d3.axisBottom()
                              .tickValues(provinces)
                              .ticks(provinces.length)
                              .scale(xAxisScale);

                var yAxis = d3.axisLeft()
                              .scale(yScale);

                yAxis.tickFormat(d => d + "%");


                svg.append("g")
                   .attr("class", "axis")
                   .attr("id", "xAxis")
                   .attr("transform", "translate(0," + (heightGraph - barPadding) + ")")
                   .call(xAxis)
                   .style("text-anchor", "end")
                   .selectAll("text")
                   .attr("transform", "rotate(-65)");

                svg.append("g")
                   .attr("class", "axis")
                   .attr("transform", "translate(" + space + ",0)")
                   .call(yAxis);
              });




        </script>
    </body>
</html>
