<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <!-- <title>D3 Test</title> -->
        <link href="styles.css" rel="stylesheet">
        <script src="https://d3js.org/d3.v5.min.js"></script>
    </head>
    <body>
        <script type="text/javascript">
            // Your beautiful D3 code will go here
            d3.select("head")
              .append("title")
              .attr("class", "title")
              .text("Labour participation Netherlands");

            d3.select("body")
              .append("p")
              .style("font-size", "25px")
              .style("font-weight", "bold")
              .text("Labour participation NL per province");

            d3.select("body")
              .append("p")
              .style("font-size", "15px")
              .style("font-weight", "normal")
              .text("Name: Julien Fer");

            d3.select("body")
              .append("p")
              .style("font-size", "15px")
              .style("font-weight", "normal")
              .text("Studentnumber: 10649441");

            d3.select("body")
              .append("p")
              .style("font-size", "15px")
              .style("font-weight", "normal")
              .text("The bar chart visualizes the unemployment rate in the netherlands per province (2018)")

            var provinces = [];
            dimGraph = {"width": 1000, "height": 500, "space": 100,
                        "widthGraph": 800, "heightGraph": 400, "animateDuration": 700,
                        "animateDelay": 100, "year": "2018", "barPadding": 1,
                        "data": []};

            // read local JSON file
            d3.json("arbeidsdeelname.json").then(function(dataset) {
              provinces = Object.keys(dataset);
              dimGraph["provinces"] = provinces

              dimGraph.provinces.forEach( function(province) {
                dimGraph.data.push(dataset[province][dimGraph.year]);
              })

              var svg = d3.select("body")
                          .append("svg")
                          .attr("class", "svg")
                          .attr("width", dimGraph.width)
                          .attr("height", dimGraph.height);

              var yScale = d3.scaleLinear()
                             .domain([0, d3.max(dimGraph.data)])
                             .range([dimGraph.heightGraph, dimGraph.space]);
              var xScale = d3.scaleLinear()
                             .domain([0, dimGraph.data.length])
                             .range([dimGraph.space, dimGraph.width - dimGraph.space]);

              // source code for tooltip:
              // https://www.youtube.com/watch?v=5pNz_Dyf9_c&index=7&list=PLillGF-RfqbY8Vy_G5WxXwhZx4eXI6Oea
              var tooltip = d3.select("body").append("div")
                            .attr("class", "tooltip")
                            .style('position','absolute')
                            .style('background','#f4f4f4')
                            .style('padding','5 15px')
                            .style('border','1px #333 solid')
                            .style('border-radius','5px')
                            .style('opacity','0')

              var myChart = svg.selectAll("rect")
                 .data(dimGraph.data)
                 .enter()
                 .append("rect")
                 .attr("class", "bar")
                 .attr("id", function(d, i) {
                   return dimGraph.provinces[i];
                 })
                 .attr("x", function(d, j) {
                      return xScale(j);
                  })
                  .attr("y", dimGraph.eightGraph)
                   .attr("fill", function(d) {
                       return "rgb(102, " + (d * 40) + ", 102)";
                   })
                 .attr("width", dimGraph.widthGraph / dimGraph.data.length - dimGraph.barPadding)
                 .attr("height", 0)
                  .on('mouseover', function(d, k){
					               tooltip.transition()
						                   .style('opacity', 1)

					               tooltip.html("Unemployment: " + d + "%")
						                   .style('left', (xScale(k) + 0.5 * dimGraph.widthGraph / dimGraph.data.length - dimGraph.barPadding)+ 'px')
						                   .style('top', (yScale(d) + 2 * dimGraph.space)+ 'px')

            					d3.select(this).style('opacity', 0.5)
            				})
            			   .on('mouseout', function(d){
            			   	tooltip.transition()
            			   		.style('opacity', 0)
            			   	d3.select(this).style('opacity', 1)
                    });


                svg.selectAll("text")
                   .data(dimGraph.data)
                   .enter()
                   .append("text")
                   .attr("class", "labels")
                   .text(function(d) {
                     return d;
                   })
                   .attr("x", function(d, i) {
                     return xScale(i) + 0.5 * dimGraph.widthGraph / dimGraph.data.length - dimGraph.barPadding;
                   })
                   .attr("y", function(d) {
                     return yScale(d) + 14;
                   });

                var xAxisScale = d3.scaleBand()
                                   .domain(dimGraph.provinces)
                                   .range([dimGraph.space, dimGraph.width - dimGraph.space])
                                   .paddingInner(0.05);

                var xAxis = d3.axisBottom()
                              .tickValues(provinces)
                              .ticks(dimGraph.provinces.length)
                              .scale(xAxisScale);

                var yAxis = d3.axisLeft()
                              .scale(yScale);

                yAxis.tickFormat(d => d + "%");




                svg.append("g")
                   .attr("class", "axis")
                   .attr("id", "xAxis")
                   .attr("transform", "translate(0," + (dimGraph.heightGraph - dimGraph.barPadding) + ")")
                   .call(xAxis)
                   .style("text-anchor", "end")
                   .selectAll("text")
                   .attr("transform", "rotate(-65)");

                svg.append("g")
                   .attr("class", "axis")
                   .attr("transform", "translate(" + dimGraph.space + ",0)")
                   .call(yAxis);

                // create Title
                svg.append("text")
                   .attr("x", dimGraph.width / 2 )
                   .attr("y", dimGraph.space / 2)
                   .attr("id", "titleGraph")
                   .style("text-anchor", "middle")
                   .style("font-weight", "bold")
                   .style("text-decoration", "underline")
                   .style("font-size", "20px")
                   .text("Unemployment rate the Netherlands per province (2018)");

                // create title y axis
                svg.append("text")
                   .attr("x", dimGraph.heightGraph / 2 - 2 * dimGraph.space - 240)
                   .attr("y", dimGraph.widthGraph / 2 - 3.5 * dimGraph.space)
                   .attr("transform", "rotate(-90)")
                   .attr("id", "titleXaxis")
                   .style("text-anchor", "middle")
                   .style("font-weight", "bold")
                   .style("font-size", "20px")
                   .text("Unemployment");

                // creat title x axis
                svg.append("text")
                   .attr("x", dimGraph.width / 2)
                   .attr("y", dimGraph.heightGraph + dimGraph.space)
                   .attr("id", "titleYaxis")
                   .style("text-anchor", "middle")
                   .style("font-weight", "bold")
                   .style("font-size", "20px")
                   .text("Provinces");

                myChart.transition()
                      .attr("height", function(d){
                        return dimGraph.heightGraph - yScale(d);
                      })
                      .attr("y", function(d, i){
                        return yScale(d);
                      })
                      .duration(dimGraph.animateDuration)
                      .delay(function(d, j){
                        return j * dimGraph.animateDelay;
                      })
                      .ease(d3.easeElastic);
              });




        </script>
    </body>
</html>
