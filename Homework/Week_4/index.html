<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <!-- <title>D3 Test</title> -->
        <script src="https://d3js.org/d3.v5.min.js"></script>
    </head>
    <body>
        <script type="text/javascript">
            // Your beautiful D3 code will go here
            d3.select("head")
              .append("title")
              .text("Labour participation Netherlands");

            d3.select("body")
              .style("font-size", "16px")
              .style("text-dectoration", "bold")
              .text("Labour participation NL per province");

            d3.select("body")
              .append("p")
              .style("font size", "12px")
              .text("Name: Julien Fer");

            d3.select("body")
              .append("p")
              .style("font size", "12px")
              .text("Studentnumber: 10649441");

            d3.select("body")
              .append("p")
              .style("font size", "12px")
              .text("The bar chart visualizes the unemployment rate in the netherlands per province")

            var file = "arbeidsdeelname.json";
            var startYear = 2010;
            var endYear = 2018;
            const WIDTH = 500;
            const HEIGHT = 500;
            var yearsInt = [];
            var yearsString = [];
            var dataset = [];
            var counter = 0;
            var txtFile =  new XMLHttpRequest();
            txtFile.onreadystatechange = function(){
              if (txtFile.readyState === 4 && txtFile.status == 200){
                var data = JSON.parse(txtFile.responseText);
                var provinces = Object.keys(data);
                // console.log(provinces);
                // console.log(data[provinces[0]]["2010"])
                provinces.forEach( function(province){
                  var dataUnemployment = [];
                  for (var i = startYear; i <= endYear; i++){
                    var year = i.toString();
                    dataUnemployment.push(data[province][year]);
                    // d3.select("body")
                    //   .data(dataUnemployment[startYear - startYear])
                    //   .enter()
                    //   .append("p")
                    //   .attr("class", province + year)
                    //   .text(province + year);
                  }
                  dataset.push(dataUnemployment);
                  // console.log(dataUnemployment);
                  d3.select("body")
                    .data(dataUnemployment)
                    .enter()
                    .append("p")
                    .attr("class", province)
                    .text(province);
                });
                // d3.select("body")
                //   .data(dataset)
                //   .enter()
                //   .append("p")
                //   .text("dataset");
                console.log(dataset);

                var svg = d3.select("body")
                .append("svg")
                .attr("width", WIDTH)
                .attr("height", HEIGHT);

                var rectangles = svg.selectAll("rect")
                                  .data(dataset[0])
                                  .enter()
                                  .append("rect");

                rectangles.attr("x", function(d, i) {
                  return 20 * i;
                })
                       .attr("y", function(d, i) {
                         return i * 5;
                       })
                       .attr("width", 30)
                       .attr("height", 20)
                      .attr("fill", "yellow")
                      .attr("stroke", "orange")
                      .attr("stroke-width", function(d) {
                      return d/2;
                  });
              }
            }
          txtFile.open("GET", file);
          txtFile.send();
        </script>
    </body>
</html>
